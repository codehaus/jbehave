<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>Developing Scenarios</title>
</head>

<body>

<h2>Writing Textual Scenarios</h2>

<p>BDD encourages you to start defining the scenarios that express
the desired behaviour in a textual format, e.g.:
<pre class="brush: plain">
    Given a stock of symbol STK1 and a threshold of 10.0
    When the stock is traded at 5.0
    Then the alert status should be OFF
    When the stock is traded at 11.0
    Then the alert status should be ON
</pre>. The textual scenario should use the language of the business domain
and shield away as much as possible the details of the technical
implementation. Also, it should be given a name that is expressive of
the functionality that is being verified, i.e. <b>trader_is_alerted_of_status.scenario</b>.
</p>
<p>The scenario should use a syntax compatible with the <a
    href="bdd-grammar.html">BDD Grammar</a>.</p>

<h2>Mapping Textual Scenarios to Java</h2>

<p>JBehave maps textual steps to Java method via a <a
    href="javadoc/core/org/jbehave/scenario/steps/CandidateSteps.html">CandidateSteps</a>
class. The scenario writer need only extends the default implementation
<a href="javadoc/core/org/jbehave/scenario/steps/Steps.html">Steps</a>,
and provide annotated method that match the textual steps by regex
patterns: <pre class="brush: java">
   public class TraderSteps extends Steps {

    private Stock stock;

    @Given("a stock of symbol $symbol and a threshold of $threshold")
    public void aStock(String symbol, double threshold) {
        stock = new Stock(symbol, threshold);
    }

    @When("the stock is traded at $price")
    public void theStockIsTradedAt(double price) {
        stock.tradeAt(price);
    }

    @Then("the alert status should be $status")
    public void theAlertStatusShouldBe(String status) {
        ensureThat(stock.getStatus().name(), equalTo(status));
    }

}
</pre></p>

<h2>Running Scenarios</h2>

<p>In JBehave Core scenarios can be run in an automated way via a
one-to-one mapping to Java files. The mechanism via which the textual
scenarios are resolved is determined by the implementation of the <a
    href="javadoc/core/org/jbehave/scenario/parser/ScenarioNameResolver.html">ScenarioNameResolver</a>.
In our example, we need to create a file <code>TraderIsAletedOfStatus.java</code>,
which maps to out textual scenario in same package.</p>

<p>The contract for a user-defined Java scenario is the following:</p>
<p>Must extend an instance of a <a
    href="javadoc/core/org/jbehave/scenario/RunnableScenario.html">RunnableScenario</a>,
such as <a href="javadoc/core/org/jbehave/scenario/JUnitScenario.html">JUnitScenario</a>
</p>
<p>Must provide a default constructor.</p>
<p>(Only when running via Maven) Must provide an additional
constructor with a ClassLoader parameter.</p>

<p>Thus in our case the example Scenario would look like: <pre class="brush: java">
   public class TraderIsAletedOfStatus extends JUnitScenario {

    public TraderIsAletedOfStatus() {
        this(Thread.currentThread().getContextClassLoader());
    }

    public TraderIsAletedOfStatus(final ClassLoader classLoader) {
        super(new MostUsefulConfiguration() {
            public ScenarioDefiner forDefiningScenarios() {
                return new ClasspathScenarioDefiner(new UnderscoredCamelCaseResolver(".scenario"), 
                            new PatternScenarioParser(new PropertyBasedConfiguration()), classLoader);
            }
        }, new TraderSteps());
    }

}
</pre></p>
<p>Here we are configuring our textual scenario files to end with
extension <b>.scenario</b>, by overriding the default behaviour of <a
    href="javadoc/core/org/jbehave/scenario/parser/UnderscoredCamelCaseResolver.html">UnderscoredCamelCaseResolver</a>
which has no extension.</p>

<h2>Next?</h2>

<span class="followup">The <a href="configuring-scenarios.html">Configuring
Scenarios</a> page will go into more configuration details and <a
    href="running-scenarios.html">Running Scenarios</a> into the
different ways to run scenarios.</span>

<div class="clear">
<hr />
</div>

</body>
</html>
