<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>Dependency Injection</title>
</head>

<body>

<h2>Introduction</h2>

<p><a href="http://www.martinfowler.com/articles/injection.html">Dependency
Injection</a> has become an integral part of modern software design. We
discuss here the different ways in which JBehave supports dependency
injection.</p>

<h2>Steps class-level injection</h2>

<p>Steps classes often use external dependencies to interface to the
system whose behaviour is being verified.</p>

<h3>Using PicoContainer</h3>

<p>Steps can be instantiated via PicoContainer using the <a
    href="javadoc/core/org/jbehave/scenario/steps/pico/PicoStepsFactory.html">PicoStepsFactory</a>
(the extension module <b>jbehave-pico</b> needs to be added to the classpath):
</p>

<pre class="brush: java">
public class PicoTraderScenario extends TraderScenario {

    public PicoTraderScenario(Class scenarioClass) {
        super(scenarioClass);
    }

    @Override
    protected CandidateSteps[] createSteps(StepsConfiguration configuration) {
        PicoContainer parent = createPicoContainer();
        return new PicoStepsFactory(configuration, parent).createCandidateSteps();
    }

    private PicoContainer createPicoContainer() { 
        // users can also use any other way to create a PicoContainer, e.g. via a script language        
        MutablePicoContainer parent = new DefaultPicoContainer(new Caching().wrap(new ConstructorInjection()));
        parent.as(Characteristics.USE_NAMES).addComponent(TradingService.class);
        parent.as(Characteristics.USE_NAMES).addComponent(TraderSteps.class);
        parent.as(Characteristics.USE_NAMES).addComponent(BeforeAfterSteps.class);
        return parent;
    }
    
}
</pre>

<h3>Using Spring</h3>

<p>Steps can be instantiated via Spring using the <a
    href="javadoc/core/org/jbehave/scenario/steps/spring/SpringStepsFactory.html">SpringStepsFactory</a>
(the extension module <b>jbehave-spring</b> needs to be added to the classpath):
</p>

<pre class="brush: java">
public class SpringTraderScenario extends TraderScenario {

    public SpringTraderScenario(Class scenarioClass) {
        super(scenarioClass);
    }

    @Override
    protected CandidateSteps[] createSteps(StepsConfiguration configuration) {
        ListableBeanFactory parent = createBeanFactory();
        return new SpringStepsFactory(configuration, parent).createCandidateSteps();
    }

    private ListableBeanFactory createBeanFactory() {
        return (ListableBeanFactory) new ClassPathXmlApplicationContext(
                new String[] { "org/jbehave/examples/trader/spring/steps.xml" });
    }

}
</pre>

<div class="clear">
<hr />
</div>

</body>
</html>
