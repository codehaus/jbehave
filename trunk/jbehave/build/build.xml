<project name="jbehave" basedir="." default="dist">

    <!-- PROPERTIES -->
    <property name="project" value="${ant.project.name}"/>
    <property name="version" value="0.0.1-SNAPSHOT"/>

    <!-- working area stuff -->
    <property name="working.dir" location="delete_me" />
    <property name="working.javadoc.dir" location="${working.dir}/javadoc" />
    <property name="working.src.jar" location="${working.dir}/${project}-src.jar"/>
    <!-- property name="working.snapshot.name" value="${project}-snapshot"/ -->
    <!-- property name="working.src.dir" location="${working.dir}/${working.snapshot.name}" /-->

    <!-- dist stuff -->
    <property name="dist.dir" location="dist"/>
    <property name="dist.website.dir" location="${dist.dir}/website"/>
    <property name="dist.javadoc.dir" location="${dist.website.dir}/docs/javadoc"/>
    <property name="dist.website.dist.dir" location="${dist.website.dir}/dist"/>

    <!-- core -->
    <property name="core.dir" location="../core"/>
    <property name="core.build.dir" location="${core.dir}/build"/>
    <property name="core.src.dir" location="${core.dir}/src"/>

    <!-- extensions -->
    <property name="extensions.dir" location="../extensions"/>

    <!-- website -->
    <property name="website.dir" location="../website"/>

    <target name="-init">
        <fail message="Version not defined" unless="version"/>
    </target>

    <!-- BUILD AND ASSEMBLY TARGETS -->

    <target name="core" depends="-init">
        <ant dir="${core.build.dir}" target="dist">
            <property name="version" value="${version}"/>
            <property name="dist.dir" location="${dist.dir}"/>
        </ant>
    </target>

    <target name="extensions" depends="core">
        <subant target="dist">
            <property name="version" value="${version}"/>
            <property name="dist.dir" location="${dist.dir}"/>
            <dirset dir="${extensions.dir}" includes="*/build" excludes="component-skeleton/build"/>
        </subant>
    </target>

    <!-- WEBSITE TARGETS -->

    <target name="website">
        <exec executable="ruby" dir="${website.dir}">
            <arg value="skinner.rb"/>
        </exec>
    </target>

    <target name="javadoc">
        <mkdir dir="${working.javadoc.dir}"/>
        <javadoc destdir="${working.javadoc.dir}"
                windowtitle="JBehave API Documentation"
                useexternalfile="true"
                verbose="true">

            <classpath>
                <fileset dir="${extensions.dir}">
                    <include name="*/lib/*.jar"/>
                </fileset>
            </classpath>

            <fileset dir="${extensions.dir}">
                <include name="*/src/**/*.java"/>
            </fileset>
            <fileset dir="${core.src.dir}">
                <include name="**/*.java"/>
            </fileset>

            <group title="Core API" packages="jbehave*"/>
            <group title="Optional Extensions" packages="jbehave.extensions*"/>
        </javadoc>
    </target>

    <target name="srcjar">
        <jar destfile="${working.src.jar}">
            <zipfileset dir=".." prefix="jbehave-${version}">
                <exclude name="**/*.class" />
                <exclude name="**/bin/**" />
                <exclude name="**/classes/**" />
                <exclude name="**/dist/**" />
                <exclude name="**/delete_me/**"/>
                <exclude name="**/jbehave-core*.jar"/>
                <exclude name="website/output/**"/>

                <!--
                <include name="core/**"/>
                <include name="extensions/**"/>
                <include name="build/build.xml" />
                <include name="website/**"/>
                -->
            </zipfileset>
        </jar>
    </target>

    <target name="dist" depends="core, extensions, website, javadoc, srcjar">
        <copy todir="${dist.website.dir}">
            <fileset dir="${website.dir}/output" />
        </copy>
        <copy todir="${dist.javadoc.dir}">
            <fileset dir="${working.javadoc.dir}" />
        </copy>
        <copy todir="${dist.website.dist.dir}" file="${working.src.jar}"/>

    </target>

    <!-- HOUSEKEEPING TARGETS -->

    <target name="clean" >
        <delete dir="${working.dir}" />
    </target>

    <target name="clobber" depends="clean">
        <delete dir="${dist.dir}" />
        <subant target="clobber">
            <property name="version" value="${version}"/>
        <property name="dist.dir" location="${dist.dir}"/>
            <dirset dir="${extensions.dir}" includes="*/build" excludes="component-skeleton/build"/>
        </subant>
    </target>
</project>
